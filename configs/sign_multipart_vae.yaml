# SignGPT3 VAE Training Config (MultiPartVae - Multi-Part Continuous VAE)
# Based on MotionGPT3's MLD VAE architecture with part-specific encoders

NAME: SignGPT3_vae_multipart
DEBUG: False
ACCELERATOR: 'gpu'
NUM_NODES: 1
DEVICE: [0]
FOLDER: experiments
FOLDER_EXP: experiments/signgpt3

LOGGER:
  TYPE: ['WandbLogger']
  PROJECT: signgpt3
  OFFLINE: True
  SAVE_DIR: experiments/signgpt3/logs
  VAL_EVERY_STEPS: 10

TRAIN:
  STAGE: vae
  BATCH_SIZE: 128
  END_EPOCH: 2000
  RESUME: ''
  PRETRAINED: ''
  PRETRAINED_VAE: ''
  NUM_WORKERS: 8
  instruction_type: 'caption'
  
  OPTIM:
    target: AdamW
    params:
      lr: 2e-4
      betas: [0.9, 0.99]
      weight_decay: 0.0
  
  LR_SCHEDULER:
    target: CosineAnnealingLR
    params:
      T_max: 2000
      eta_min: 1e-6

EVAL:
  SPLIT: val
  BATCH_SIZE: 32
  NUM_WORKERS: 4

TEST:
  SPLIT: test
  BATCH_SIZE: 32
  SAVE_PREDICTIONS: False
  CHECKPOINTS: ''
  REP_I: 0
  NUM_WORKERS: 4

# =============================================================================
# Dataset
# =============================================================================
DATASET:
  target: motGPT.data.H2S.H2SDataModule
  JOINT_TYPE: smplx
  NFEATS: 133
  NJOINTS: 55
  
  H2S:
    DATASET_NAME: how2sign_csl_phoenix
    ROOT: /home/user/Projects/research/SOKE/data/How2Sign
    CSL_ROOT: /home/user/Projects/research/SOKE/data/CSL-Daily
    PHOENIX_ROOT: /home/user/Projects/research/SOKE/data/Phoenix_2014T
    MEAN_PATH: /home/user/Projects/research/SOKE/data/CSL-Daily/mean.pt
    STD_PATH: /home/user/Projects/research/SOKE/data/CSL-Daily/std.pt
    FPS: 25
    MAX_MOTION_LEN: 300
    MIN_MOTION_LEN: 40
    MAX_TEXT_LEN: 40
    UNIT_LEN: 4

# =============================================================================
# Metrics
# =============================================================================
METRIC:
  TYPE: ['MRMetrics']
  DIST_SYNC_ON_STEP: True
  DIVERSITY_TIMES: 300
  MM_NUM_TIMES: 10
  MM_NUM_REPEATS: 30

# =============================================================================
# Loss
# =============================================================================
LOSS:
  LAMBDA_REC: 1.0
  LAMBDA_FEATURE: 1.0
  LAMBDA_VELOCITY: 0.0
  LAMBDA_KL: 1e-5
  LAMBDA_LATENT: 1e-5
  LAMBDA_COMMIT: 0.02
  LAMBDA_CLS: 1.0
  LAMBDA_DIFF: 1.0
  ABLATION:
    RECONS_LOSS: l1_smooth

# =============================================================================
# Model
# =============================================================================
model:
  target: motGPT.models.motgpt.MotGPT
  params:
    lm: null
    motion_vae: ${vae.mldvae}
    stage: vae
    debug: ${DEBUG}
    task: t2m
    condition: text
    metrics_dict: ${METRIC.TYPE}
    guidance_scale: 1.0
    codebook_size: 512

# =============================================================================
# VAE Config (MultiPartVae - Part-specific VAE with Cross-Attention)
# =============================================================================
vae:
  mldvae:
    target: motGPT.archs.multipart_vae.MultiPartVae  # ← MultiPartVae!
    params:
      nfeats: ${DATASET.NFEATS}          # 133
      
      # Transformer settings
      latent_dim: 256                     # 각 파트의 latent dim (모두 동일)
      ff_size: 1024
      num_layers: 6                       # 파트별 encoder/decoder layers
      num_heads: 4
      dropout: 0.1
      activation: gelu
      
      # 3개의 독립적인 z, 각각 256 dim
      # z_body:  (1, B, 256)
      # z_lhand: (1, B, 256)
      # z_rhand: (1, B, 256)
      
      # Cross-attention settings
      num_cross_layers: 2                 # 파트 간 cross-attention layers
      
      # Loss weights (손에 더 높은 가중치)
      body_weight: 1.0
      lhand_weight: 2.0                   # 왼손 reconstruction 중요
      rhand_weight: 2.0                   # 오른손 reconstruction 중요
      
      ablation: ${ABLATION}

# =============================================================================
# Ablation Settings
# =============================================================================
ABLATION:
  VAE_TYPE: multipart                     # ← 변경
  VAE_ARCH: encoder_decoder
  PE_TYPE: mld
  DIFF_PE_TYPE: mld
  SKIP_CONNECT: True
  MLP_DIST: False
  IS_DIST: False
  PREDICT_EPSILON: True

SEED_VALUE: 1234
FULL_CONFIG: false